#!/bin/bash
ln -sf /usr/share/zoneinfo/Europe/London /etc/localtime
hwclock --systohc
locale-gen
echo "LANG=en_UK.UTF-8" >> /etc/locale.conf
echo "KEYMAP=uk" >> /etc/vconsole.conf
localectl set-x11-keymap gb
echo "Configuring network"
echo "arch" >> /etc/hostname
echo "127.0.0.1 localhost" >> /etc/hosts
echo "::1       localhost" >> /etc/hosts
echo "127.0.1.1 arch.localdomain arch" >> /etc/hosts
cat /etc/hosts
echo "Root password:"
passwd
echo "Installing base packages"
pacman -S --noconfirm linux-firmware neofetch vim grub efibootmgr networkmanager network-manager-applet reflector base-devel linux-headers-lts os-prober terminus-font openssh bash-completion dnsutils sudo intel-ucode xorg xorg-server xorg-server-utils xorg-xinit iwd firefox alsa-utils alsa-plugins && alsamixer pulseaudio pulseaudio-alsa chromium
reflector -c "GB" -f 12 -l 10 -n 12 --save /etc/pacman.d/mirrorlist
#gpu drivers
# pacman -S  xf86-video-amdgpu
pacman -S  nvidia nvidia-utils nvidia-settings

echo "Configuring grub bootloader"
#uefi
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg

#bios
# grub-install --target=i386-pc /dev/sda # replace sda with your disk name, not the partition
# grub-mkconfig -o /boot/grub/grub.cfg

echo "Install Paru AUR helper"
cd ~/.local/
git clone https://aur.archlinux.org/paru.git
cd paru
makepkg -si
cd
echo "Paru installed sucessfully"

echo "Configuring base services"
systemctl enable NetworkManager
systemctl enable sshd
systemctl enable iwd
echo "Creating a new user"
useradd -m piplewis
echo "Password for piplewis:"
passwd piplewis
echo "piplewis ALL=(ALL) ALL" >> /etc/sudoers.d/piplewis
echo "piplewis now has sudo privilleges."

echo "Final configuration"
mkinitcpio -P
echo "Installation complete."